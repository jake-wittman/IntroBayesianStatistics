data = list(N1=100,N0=5,p=1,
     X=matrix(1,105,1),
     x=c(0.055695, 6.356659, 1.203766, 4.346161, 4.902496, 9.800262, 7.623749, 4.257965,
         2.834625, 5.496979, 9.685822, 8.224030, 1.717682, 4.939423, 7.150726, 1.042328,
         7.318878, 3.234406, 4.809723, 5.287323, 7.876740, 0.236359, 2.679901, 3.064117,
         9.922943, 2.929840, 7.448883, 9.019012, 5.351410, 9.062347, 5.171661, 4.596710,
         9.738312, 2.026520, 5.214386, 3.546906, 1.913910, 6.994171, 5.450592, 8.683929,
         4.781036, 8.298798, 8.705902, 9.892731, 7.387543, 8.067474, 0.453949, 3.388519,
         8.244171, 6.104279, 7.761383, 2.223358, 9.896698, 1.023407, 9.482880, 8.043671,
         4.745636, 2.631378, 7.707367, 4.099579, 2.115936, 5.560760, 0.451813, 9.501190,
         6.579132, 4.151764, 5.608063, 4.727020, 7.521210, 8.585663, 6.137238, 8.382416,
         9.965057, 2.268219, 6.516266, 5.206146, 6.638947, 0.460968, 0.430756, 5.328827,
         1.298370, 0.165863, 9.723053, 4.781342, 3.296051, 1.256561, 4.586029, 7.251434,
         3.401031, 8.861847, 5.008087, 7.092133, 0.870514, 6.999054, 3.470001, 3.579865,
         1.769867, 3.455658, 8.888702, 6.421967, 5.000000, 3.500000, 4.000000, 3.000000,
         9.000000),
     y=c(6.682587, 3.859406, 6.327362, 0.546112, 6.787567, 9.167328, 2.265472, 7.670135,
         5.430756, 0.363007, 7.606354, 2.096100, 8.898163, 1.914825, 3.575897, 3.998566,
         1.021881, 8.697052, 7.558441, 1.477509, 9.467010, 2.592010, 2.510529, 5.284882,
         8.272858, 5.341644, 2.626190, 9.803314, 6.641083, 7.649384, 5.249176, 0.269318,
         3.974152, 4.530487, 9.038544, 6.253510, 1.165314, 6.915741, 8.381500, 1.384125,
         8.137665, 9.500885, 4.058685, 9.325104, 7.632599, 4.849701, 0.157318, 6.002350,
         5.249176, 3.744659, 7.235260, 8.080292, 5.733185, 1.788483, 1.736298, 7.688751,
         5.516205, 2.256927, 1.652374, 3.398895, 1.504669, 5.198517, 8.438873, 7.449799,
         6.118927, 2.787323, 5.178375, 9.225922, 8.582611, 0.924225, 0.995026, 4.982758,
         2.460785, 7.088776, 1.717987, 3.823700, 9.450531, 4.440155, 6.795807, 9.926605,
         9.417877, 2.168732, 2.460175, 1.020355, 6.688995, 2.098541, 1.141205, 3.111725,
         2.588043, 1.537933, 7.129364, 1.461334, 4.226837, 2.381744, 8.491974, 7.810211,
         9.542999, 6.461945, 5.235443, 3.857269, 5.000000, 3.500000, 6.000000, 7.000000,
         9.000000),
     Y1=c(5.972015, 3.391376, 4.890790, 5.352072, 4.423553, 3.056831, 4.552995, 4.364710,
          7.373618, 6.553847, 5.179496, 3.910392, 7.299458, 5.008502, 2.886510, 3.387636,
          3.811434, 5.344237, 3.341748, 6.605178, 3.243050, 5.100154, 7.905932, 8.359168,
          5.100291, 7.542276, 4.451773, 3.958391, 4.917973, 4.553657, 4.853381, 5.391461,
          5.917742, 6.872738, 3.927727, 5.328711, 6.023674, 3.494004, 4.543607, 6.858539,
          3.502842, 4.674970, 4.508320, 4.309353, 4.068234, 3.375284, 5.579153, 6.482382,
          2.989509, 4.464341, 5.831522, 9.063980, 4.052630, 6.986207, 6.722441, 5.391418,
          3.985553, 6.461910, 6.225331, 6.105033, 8.130884, 3.953500, 5.186510, 4.139176,
          3.242921, 5.811007, 6.538094, 4.454359, 6.414786, 5.166128, 5.324738, 3.016018,
          7.301108, 6.693659, 4.947989, 7.215193, 3.866677, 4.556925, 6.762912, 6.934457,
          5.576024, 7.454319, 5.541343, 5.960220, 6.227696, 4.727305, 5.376647, 4.263196,
          4.637220, 6.192736, 2.983474, 5.180660, 4.411182, 4.263029, 4.901359, 6.146519,
          4.069671, 6.617947, 3.959419, 4.105066)
)

library(fields)
xy.coords <- cbind(data$x,data$y)
dist = rdist(xy.coords)

library(rstan)

N1=data$N1;
N0=data$N0;
p=data$p;
X=data$X;
Y1=data$Y1;

geo.model <- stan_model(file = "lectures/code/geostat.stan")

fit.geo <- sampling(
    geo.model,
    data = list(
        N1 = N1,
        p = p,
        X = X,
        Y1 = Y1,
        dist = dist,
        N0 = N0
    ),
    chains = 2,
    warmup = 1000,
    iter = 8000,
    save_warmup = FALSE,
    cores = 2,
    control = list(adapt_delta = 0.95)
)
beepr::beep(6)
print(fit.geo, pars=c('beta','phi','sigma_sq','tau_sq','Y0'),digits=3, probs=c(.025,.5,.975))
sample.para <- extract(fit.geo, pars=c('beta','phi','sigma_sq','tau_sq','Y0'))

